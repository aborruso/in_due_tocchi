---
import SiteFooter from '../components/SiteFooter.astro';
import { getSeoData } from '../lib/seo.js';

const { meta: pageSeo } = getSeoData('home', Astro);
---

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Guida per usare ShareForge da desktop con bookmarklet" />
  <meta name="theme-color" content="#3b82f6" />
  <title>ShareForge - Guida Desktop</title>
  <link rel="icon" type="image/svg+xml" href="/in_due_tocchi/favicon.svg" />
  <link rel="manifest" href="/in_due_tocchi/manifest.webmanifest" />
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col">
  <main class="container mx-auto px-4 py-8 max-w-3xl flex-1">
    <div class="bg-white rounded-lg shadow-lg p-6 md:p-8 space-y-6">
      <!-- Header -->
      <header class="text-center border-b pb-4">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
          Come usare ShareForge da Desktop
        </h1>
        <p class="text-gray-600">
          Cattura URL e titolo con un click usando il bookmarklet
        </p>
      </header>

      <!-- Why Section -->
      <section class="space-y-3">
        <h2 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">
          <span>ü§î</span>
          <span>Perch√© il bookmarklet?</span>
        </h2>
        <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded">
          <p class="text-gray-700 leading-relaxed">
            Su desktop <strong>non esiste uno share nativo universale</strong> come su Android.
            Windows, macOS e Linux non hanno un sistema di condivisione centralizzato, e le app
            desktop non supportano la Web Share Target API.
          </p>
          <p class="text-gray-700 leading-relaxed mt-2">
            Il <strong>bookmarklet</strong> √® la soluzione pi√π semplice: un link nei segnalibri
            che cattura URL e titolo della pagina corrente e apre ShareForge con i campi precompilati.
          </p>
        </div>
      </section>

      <!-- Installation Section -->
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">
          <span>üì•</span>
          <span>Installazione</span>
        </h2>

        <div class="space-y-4">
          <!-- Method 1: Drag and Drop -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3">
            <h3 class="font-semibold text-lg text-gray-800">Metodo 1: Drag & Drop (pi√π facile)</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
              <li>Assicurati che la <strong>barra dei segnalibri</strong> sia visibile nel browser</li>
              <li>Trascina questo link nella barra dei segnalibri:</li>
            </ol>
             <div class="flex justify-center py-4">
               <a
                 id="bookmarklet-link"
                 href="javascript:(function(){var t=encodeURIComponent(document.title||""),u=encodeURIComponent(window.location.href||""),s="https://aborruso.github.io/in_due_tocchi/?title="+t+"&url="+u;var w=window.open(s,"_blank");if(!w)window.location.href=s})();"
                 class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors cursor-move border-2 border-blue-700"
                 draggable="true"
                 title="Trascina nella barra dei segnalibri"
                 aria-label="ShareForge"
               >
                 <span class="text-2xl" aria-hidden="true">üìå</span>
                 <span id="bookmarklet-text">ShareForge</span>
               </a>
             </div>
            <p class="text-sm text-gray-600 italic text-center">
              ‚òùÔ∏è Trascina questo pulsante nella barra dei segnalibri
            </p>
          </div>

          <!-- Method 2: Manual -->
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-3">
            <h3 class="font-semibold text-lg text-gray-800">Metodo 2: Manuale (pi√π affidabile)</h3>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
              <li>Clicca su "Copia" qui sotto per copiare il codice del bookmarklet</li>
              <li>Apri il gestore segnalibri del browser (Ctrl+Shift+O o Cmd+Shift+O)</li>
              <li>Crea un nuovo segnalibro:
                <ul class="list-disc list-inside ml-6 mt-1">
                  <li><strong>Nome</strong>: <code class="bg-white px-2 py-1 rounded">ShareForge</code></li>
                  <li><strong>URL</strong>: Incolla il codice copiato</li>
                </ul>
              </li>
              <li>Salva il segnalibro nella barra dei segnalibri</li>
            </ol>
            <div class="relative">
              <pre class="bg-white border border-gray-300 rounded p-3 text-xs overflow-x-auto"><code id="bookmarklet-code"></code></pre>
              <button
                id="copy-btn"
                class="absolute top-2 right-2 px-3 py-1 bg-gray-700 text-white text-xs rounded hover:bg-gray-800 transition-colors"
              >
                Copia
              </button>
            </div>
            <p class="text-xs text-gray-600 italic mt-2">
              üí° <strong>Nota</strong>: Se il drag & drop non funziona, usa questo metodo manuale che √® pi√π affidabile.
            </p>
          </div>
        </div>
      </section>

      <!-- Usage Section -->
      <section class="space-y-4">
        <h2 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">
          <span>üöÄ</span>
          <span>Come usarlo</span>
        </h2>
        <ol class="list-decimal list-inside space-y-3 text-gray-700 bg-green-50 border border-green-200 rounded-lg p-4">
          <li class="leading-relaxed">
            <strong>Naviga</strong> su qualsiasi sito web (articolo, video, pagina prodotto...)
          </li>
          <li class="leading-relaxed">
            <strong>Clicca</strong> sul bookmarklet "ShareForge" nella barra dei segnalibri
          </li>
          <li class="leading-relaxed">
            ShareForge si apre in una nuova tab con <strong>URL e titolo precompilati</strong>
          </li>
          <li class="leading-relaxed">
            <strong>Seleziona</strong> il template desiderato (sintesi, analisi, post social...)
          </li>
          <li class="leading-relaxed">
            <strong>Copia</strong> il prompt generato e incollalo nel tuo LLM preferito (ChatGPT, Claude, Gemini...)
          </li>
        </ol>
      </section>

      <!-- Browser Compatibility -->
      <section class="space-y-3">
        <h2 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">
          <span>üåê</span>
          <span>Compatibilit√†</span>
        </h2>
        <p class="text-gray-700">
          Il bookmarklet funziona su tutti i browser moderni:
        </p>
        <ul class="list-disc list-inside space-y-1 text-gray-700 ml-4">
          <li>Chrome / Chromium / Edge</li>
          <li>Firefox</li>
          <li>Safari</li>
          <li>Opera</li>
        </ul>
        <p class="text-sm text-gray-600 italic">
          <strong>Nota:</strong> Alcuni browser potrebbero bloccare i popup. In quel caso il bookmarklet
          aprir√† ShareForge nella tab corrente invece di una nuova finestra.
        </p>
      </section>

      <!-- Back Link -->
      <div class="pt-6 border-t text-center">
        <a
          href="/in_due_tocchi/"
          class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 font-medium transition-colors"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
          </svg>
          <span>Torna a ShareForge</span>
        </a>
      </div>
    </div>
  </main>

  <SiteFooter class="py-6" />

  <script>
    // Bookmarklet code - set href dynamically to avoid HTML escaping
    const bookmarkletName = 'ShareForge';
    const bookmarkletCode = `javascript:(function(){var t=encodeURIComponent(document.title||""),u=encodeURIComponent(window.location.href||""),s="https://aborruso.github.io/in_due_tocchi/?title="+t+"&url="+u;var w=window.open(s,"_blank");if(!w)window.location.href=s})();`;

    // Handle drag event to ensure correct bookmarklet URL and name are transferred
    const link = document.getElementById('bookmarklet-link');
    if (link) {
      link.addEventListener('dragstart', (e) => {
        // Set the bookmark URL and name for different browsers
        // URL target for browsers that expect it
        e.dataTransfer.setData('text/uri-list', bookmarkletCode);
        // Bookmark title (Chrome/Safari use this for the saved name)
        e.dataTransfer.setData('text/plain', bookmarkletName);
        // Provide HTML payload so Chromium keeps both name + href
        e.dataTransfer.setData('text/html', `<a href="${bookmarkletCode}">${bookmarkletName}</a>`);
        // Firefox format: URL + newline + title
        e.dataTransfer.setData('text/x-moz-url', `${bookmarkletCode}\n${bookmarkletName}`);
        // Chrome format: protocol:name:url
        e.dataTransfer.setData('DownloadURL', `application/javascript:${bookmarkletName}:${bookmarkletCode}`);
        // Chrome bookmark format: URL + newline + title
        e.dataTransfer.setData('text/x-moz-text-internal', `${bookmarkletCode}\n${bookmarkletName}`);
        // Force Chrome to use the link text as bookmark name
        e.dataTransfer.setData('text/x-bookmark', `${bookmarkletName}\n${bookmarkletCode}`);
        e.dataTransfer.effectAllowed = 'link';
      });
    }

    // Display bookmarklet code in <code> element
    const codeElement = document.getElementById('bookmarklet-code');
    if (codeElement) {
      codeElement.textContent = bookmarkletCode;
    }

    // Copy bookmarklet code to clipboard
    document.getElementById('copy-btn')?.addEventListener('click', async () => {
      const btn = document.getElementById('copy-btn');

      if (!btn) return;

      try {
        await navigator.clipboard.writeText(bookmarkletCode);
        btn.textContent = '‚úì Copiato!';
        btn.classList.add('bg-green-600');
        btn.classList.remove('bg-gray-700', 'hover:bg-gray-800');

        setTimeout(() => {
          btn.textContent = 'Copia';
          btn.classList.remove('bg-green-600');
          btn.classList.add('bg-gray-700', 'hover:bg-gray-800');
        }, 2000);
      } catch (error) {
        console.error('Failed to copy:', error);
        btn.textContent = '‚úó Errore';
      }
    });

    // Add anchor links to headings
    function addAnchorLinks() {
      const headings = document.querySelectorAll('h2[id], h3[id]');

      headings.forEach(heading => {
        // Make heading position relative for icon positioning
        heading.style.position = 'relative';
        heading.style.cursor = 'pointer';

        // Create anchor link icon
        const anchor = document.createElement('a');
        anchor.href = '#' + heading.id;
        anchor.className = 'anchor-link';
        anchor.setAttribute('aria-label', 'Copia link a questa sezione');
        anchor.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />
          </svg>
        `;

        // Position icon next to heading
        anchor.style.cssText = `
          display: inline-flex;
          align-items: center;
          margin-left: 0.5rem;
          opacity: 0;
          transition: opacity 0.2s ease;
          color: #3b82f6;
          text-decoration: none;
        `;

        // Show icon on heading hover
        heading.addEventListener('mouseenter', () => {
          anchor.style.opacity = '1';
        });

        heading.addEventListener('mouseleave', () => {
          anchor.style.opacity = '0';
        });

        // Copy URL to clipboard on click, update URL and scroll
        anchor.addEventListener('click', async (e) => {
          e.preventDefault();
          const url = window.location.origin + window.location.pathname + '#' + heading.id;

          try {
            // Copy to clipboard
            await navigator.clipboard.writeText(url);

            // Update browser URL without reload
            history.replaceState(null, '', '#' + heading.id);

            // Scroll to heading smoothly
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Temporary feedback: replace icon with checkmark
            const originalHTML = anchor.innerHTML;
            anchor.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
              </svg>
            `;
            anchor.style.color = '#10b981';

            setTimeout(() => {
              anchor.innerHTML = originalHTML;
              anchor.style.color = '#3b82f6';
            }, 1500);
          } catch (error) {
            console.error('Failed to copy anchor link:', error);
          }
        });

        heading.appendChild(anchor);
      });
    }

    // Initialize anchor links on load
    addAnchorLinks();
  </script>
</body>
</html>
